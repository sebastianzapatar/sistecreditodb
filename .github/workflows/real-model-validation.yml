name: ğŸ”¬ Real Model Validation from ADLS Gen2

on:
  push:
    branches: [ main ]
    paths:
      - 'test/**'
  pull_request:
    branches: [ main ]

jobs:
  validate-real-model:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ”„ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install scikit-learn pandas numpy joblib pytest
        pip install azure-storage-file-datalake azure-identity
        
    - name: ğŸ” Verify Environment
      run: |
        echo "ğŸ”§ Verificando configuraciÃ³n..."
        python -c "import azure.storage.filedatalake; print('âœ… Azure SDK disponible')"
        python -c "import sklearn; print('âœ… Scikit-learn disponible')"
        
    - name: ğŸ§ª Run Real Model Validation from ADLS Gen2
      env:
        AZURE_STORAGE_KEY: ${{ secrets.AZURE_STORAGE_KEY }}
      run: |
        echo "ğŸ”¬ Ejecutando validaciÃ³n real del modelo desde ADLS Gen2..."
        python test/test_model_real_from_adls.py
        
    - name: ğŸ“Š Generate Success Report
      if: success()
      run: |
        echo "## ğŸ‰ Real Model Validation SUCCESS" > validation_report.md
        echo "" >> validation_report.md
        echo "âœ… **Status**: Model successfully validated from ADLS Gen2" >> validation_report.md
        echo "" >> validation_report.md
        echo "### ğŸ”¬ Real Validation Results:" >> validation_report.md
        echo "- âœ… **Model Loading**: Loaded from ADLS Gen2 successfully" >> validation_report.md
        echo "- âœ… **Real Performance**: Evaluated with real test data" >> validation_report.md
        echo "- âœ… **Manifest Consistency**: Metrics match real evaluation" >> validation_report.md
        echo "- âœ… **Data Quality**: Test data passes quality checks" >> validation_report.md
        echo "- âœ… **Production Ready**: All production criteria met" >> validation_report.md
        echo "" >> validation_report.md
        echo "### ğŸš€ Deployment Approved:" >> validation_report.md
        echo "- Model meets all production thresholds" >> validation_report.md
        echo "- Real performance validated with actual data" >> validation_report.md
        echo "- Ready for production deployment" >> validation_report.md
        echo "" >> validation_report.md
        echo "---" >> validation_report.md
        echo "*ğŸ¤– Real validation by MLOps Pipeline - ADLS Gen2 Integration*" >> validation_report.md
        
    - name: ğŸ“ Comment PR with Results
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');
          const report = fs.readFileSync('validation_report.md', 'utf8');
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: report
          });
